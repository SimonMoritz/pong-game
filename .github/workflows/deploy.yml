name: build - deploy
run-name: ${{ github.actor }} is building and deploying
on: [push]
jobs:
  create-key-files:
    runs-on: self-hosted
    steps:
      - name: create-key-files
        uses: actions/checkout@v4
        env:
          PRIVKEY: ${{secrets.PRIVKEY}}
          FULLCHAIN: ${{secrets.FULLCHAIN}}
      - run: | 
          touch privkey.pem
          echo "${{secrets.PRIVKEY}}" > privkey.pem
          touch fullchain.pem
          echo "${{secrets.FULLCHAIN}}" > fullchain.pem 
  build-image:
    needs: create-key-files
    runs-on: self-hosted
    steps:
      - run: |
          touch notes.txt
          echo "this is a test" > notes.txt
          grep -Fx "this is a test" notes.txt
      - name: build image
        uses: docker/setup-buildx-action@v3
      - run: docker build -t pong-game .

  run:
    needs: build-image
    runs-on: self-hosted
    steps:
      - run: touch helloworld.txt